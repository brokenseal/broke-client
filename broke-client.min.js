(function(__global__){var
requestEventName='broke.request',responseEventName='broke.response';__global__.broke={};broke.$window=$(window);broke.extend=function(){var
name,target=arguments[0]||{},i=1,length=arguments.length,deep=false,options,src,copy;if(arguments.length>2){broke.extend.apply(broke,arguments.slice(1));}
if(typeof target==="boolean"){deep=target;target=arguments[1]||{};i=2;}
if(typeof target!=="object"&&!(target instanceof Function)){target={};}
if(length==i){target=this;--i;}
while(i<length){if((options=arguments[i])!==null){for(name in options){if(options.hasOwnProperty(name)){src=target[name];copy=options[name];if(target===copy){continue;}
if(deep&&copy&&typeof copy==="object"&&!copy.nodeType){target[name]=broke.extend(deep,src||(copy.length!==null?[]:{}),copy);}
else if(copy!==undefined){target[name]=copy;}}}}
i++;}
return target;};var
_isReady=false,_bindEvents=function(){var
callback,oldHash,settings=broke.conf.settings;if(settings.EVENT_TRIGGERING_METHOD=='elements'){broke.bindEvents();}else if(settings.EVENT_TRIGGERING_METHOD=='hashchange'){if(!('onhashchange'in window)){oldHash=location.hash;setInterval(function(){if(location.hash!==oldHash){oldHash=location.hash;broke.$window.trigger('hashchange');}},settings.HASHCHANGE_INTERVAL);}
window.onhashchange=function(e){broke.request({event:e,url:location.href.split('#')[1]});};}},_searchNamedUrls=function(){var
callback=function(urlChangingElement){var
_this=$(this),urlAttribute=urlChangingElement.urlAttribute,urlToRender=_this.attr(urlAttribute).split('#')[1]||'',namedUrl,args,result;if(_this.attr(urlAttribute).contains('#')){urlToRender=urlToRender.trim().split(' ');namedUrl=urlToRender[0];args=urlToRender[1];if(args){args=args.split(',');}else{args=[];}
try{result=broke.urlResolvers.reverse(namedUrl,args);_this.attr(urlAttribute,'#'+result);}catch(e){if(e.name=="NoReverseMatch"){return;}}}};builtins.forEach(broke.conf.settings.URL_CHANGING_ELEMENTS,function(key){var elements=$(key),elementsLength=elements.length;while(elementsLength--){callback.call(elements[elementsLength],this);}});},_getLanguageFiles=function(){var
settings=broke.conf.settings,languageCode=settings.LANGUAGE_CODE,localePath=builtins.interpolate('/locale/%s/LC_MESSAGES/broke.po',languageCode),localePaths=[settings.BASE_URL+'/conf'];localePaths.populate(builtins.getattr(broke.BROKE_SETTINGS_OBJECT).LOCALE_PATHS);builtins.forEach(localePaths,function(){gettext.init({url:this+localePath});});return;},_preloadRemoteTemplates=function(app){},_setLanguage=function(){var queryString=broke.urlResolvers.parseQueryString(window.location.href.split('?')[1]),cookie=$.cookie(settings.LANGUAGE_COOKIE_NAME),langCodeFromCookie;if('language'in queryString){settings.LANGUAGE_CODE=queryString.language;$.cookie(settings.LANGUAGE_COOKIE_NAME,queryString.language,{expires:30,domain:window.location.host,path:'/'});}else{langCodeFromCookie=$.cookie(settings.LANGUAGE_COOKIE_NAME);settings.LANGUAGE_CODE=langCodeFromCookie||settings.LANGUAGE_CODE;}},_initProject=function(){var
settings=broke.conf.settings;broke.extend(settings,builtins.getattr(broke.BROKE_SETTINGS_OBJECT));settings.SETTINGS_OBJECT=builtins.getattr(broke.BROKE_SETTINGS_OBJECT);broke.extend(broke.urlPatterns,builtins.getattr(settings.ROOT_URLCONF));settings.INSTALLED_APPS=builtins.map(settings.INSTALLED_APPS,function(){var
app=this,contenttypes=broke.contrib.contenttypes;if(app.constructor==String){app=builtins.getattr(this);}
if(!app){return null;}
builtins.forEach(app.models,function(){var
tableName;if(this.isUsable===false){return;}
tableName=this.getTableName();if(broke.storage[tableName]===undefined){broke.storage[tableName]=[];}
broke.modelStorageMapping[tableName]=this;if(this.autoInit){broke.initStorage(this);}
if(broke.contentTypeCache[this.appLabel]===undefined){broke.contentTypeCache[this.appLabel]={};}
broke.contentTypeCache[this.appLabel][this.__name__.toLowerCase()]=this;});if(settings.PRELOAD_REMOTE_TEMPLATES){_preloadRemoteTemplates(app);}
return app;});return settings;};broke.extend({VERSION:"0.1b",BROKE_SETTINGS_OBJECT:null,init:function(){var
settings;if(_isReady){broke.log('Broke has already been initialized! Fail silently...');return;}
if(!broke.BROKE_SETTINGS_OBJECT){broke.log(gettext.gettext('Settings object not defined!'));return;}
_initProject();settings=broke.conf.settings;if(settings.USE_I18N){}
_bindEvents();if(window.location.hash!==''){broke.request(window.location.hash.split('#')[1]);}
broke.$window.trigger('broke.ready');_isReady=true;},isReady:function(){return _isReady;},ready:function(fn){if(_isReady){fn();}
broke.$window.bind('broke.ready',fn);},preSave:function(klass,fn){broke.$window.bind('broke.'+klass.__name__.toLowerCase()+'.pre_save',fn);},postSave:function(klass,fn){broke.$window.bind('broke.'+klass.__name__.toLowerCase()+'.post_save',fn);},request:function(args,extraArgs){var req={};if(builtins.typeOf(args)=='string'){req.url=args;}else{req=args;}
broke.$window.trigger(requestEventName,[req,extraArgs]);},response:function(){broke.$window.trigger(responseEventName,arguments);},bindEvents:function(context,applyToContext){var
settings=broke.conf.settings,callback=function(e){var
_this=$(this),tag=this.tagName.toLowerCase(),urlChangingElement=settings.URL_CHANGING_ELEMENTS[tag],preventDefault=urlChangingElement.preventDefault!==undefined?urlChangingElement.preventDefault:settings.PREVENT_DEFAULT,urlAttribute=urlChangingElement.urlAttribute,url=_this.attr(urlAttribute),type=e.target.tagName.toLowerCase()=="form"?'POST':'GET',domQuery;if(url!==undefined&&url.indexOf('#')>=0){if(preventDefault){e.preventDefault();}
broke.request({event:e,url:url.split('#')[1],completeUrl:url,type:type});}};context=context||document;builtins.forEach(settings.URL_CHANGING_ELEMENTS,function(key){if(applyToContext===true){domQuery=$(context);}else{domQuery=$(key,context);}
domQuery[settings.EVENT_BINDING](this.events.join(','),callback);});},removeHash:function(){window.location.hash='';return true;},log:function(debugString,doNotAppendDate){if(broke.conf.settings.DEBUG&&'console'in window){if(!doNotAppendDate){var now=new Date();now=builtins.interpolate('%s:%s:%s:%s',[now.getHours(),now.getMinutes(),now.getSeconds(),now.getMilliseconds()]);debugString=builtins.interpolate('[%s] %s',[now,debugString]);}
console.debug(debugString);}},fetchData:function(args){var
model=args.model,settings=broke.conf.settings,url=args.url||settings.JSON_URLS.getData.interpolate({appLabel:model.appLabel,model:model.className.toLowerCase()}),filter=args.filter||{},result;$.ajax({async:false,type:"GET",url:url,data:filter,dataType:settings.AJAX.dataType,error:function(xhr,status,error){result=error;},success:function(data,status){broke.storage[model.getTableName()]=data;result=broke.storage[model.getTableName()];}});return result;},initStorage:function(model){broke.fetchData({model:model});},localStorage:(function(){var localStorageSetObject=function(key,value){this.setItem(key,JSON.stringify(value));},localStorageGetObject=function(key){return JSON.parse(this.getItem(key));},storage={};if('localStorage'in window){broke.extend(Storage.prototype,{setObject:localStorageSetObject,getObject:localStorageGetObject});return localStorage;}
return{key:function(key){throw{name:"NotImplementedError",description:"Sorry, this version of localStorage is a fake and does not support key() method."};},setItem:function(key,value){storage[key]=value;return this;},getItem:function(key){return storage[key];},removeItem:function(key){delete storage[key];return this;},setObject:localStorageSetObject,getObject:localStorageGetObject,clear:function(){storage={};return this;}};})(),bindToRequest:function(fn){broke.$window.bind(requestEventName,fn);},bindToResponse:function(fn){broke.$window.bind(responseEventName,fn);},contentTypeCache:{},storage:{},modelStorageMapping:{},shortcuts:{},conf:{settings:{}},core:{},i18n:{},locale:{},urlPatterns:[],contrib:{},views:{},template:{},templates:{},middleware:{},vars:{},db:{models:{}},contextProcessors:{},cleanData:function(kwargs,model){var
result=kwargs,defaultPistonAttributeFieldsHolder;if(model){defaultPistonAttributeFieldsHolder=model.__name__.toLowerCase()+'_ptr';}
if(defaultPistonAttributeFieldsHolder&&kwargs[defaultPistonAttributeFieldsHolder]){result={pk:kwargs[defaultPistonAttributeFieldsHolder].pk,fields:kwargs[defaultPistonAttributeFieldsHolder]};}else if(!kwargs.fields){result={pk:kwargs.pk,fields:kwargs};}
return result;},schema:{index:{},position:{},autoPk:0,get:function(pk,tableName){broke.schema.index[tableName]=broke.schema.index[tableName]||{};return broke.schema.index[tableName][pk];},set:function(tableName,kwargs){var
dbTable=broke.storage[tableName],i=dbTable.length,obj=this.get(kwargs.pk,tableName),model=broke.modelStorageMapping[tableName],position;kwargs=broke.cleanData(kwargs,model);if(!kwargs.pk){kwargs.pk=null;broke.log("Objects must have a primary key!");}
if(kwargs.pk=='auto'){kwargs.pk=broke.schema.autoPk;broke.schema.autoPk+=1;}
if(obj){position=broke.schema.position[kwargs.pk];dbTable[position]=kwargs;obj=kwargs;}else{kwargs._meta={model:model};broke.schema.index[tableName][kwargs.pk]=kwargs;position=dbTable.push(kwargs);broke.schema.position[kwargs.pk]=position-1;}
return kwargs;},'delete':function(tableName,pk){var
dbTable=broke.storage[tableName],position=broke.schema.position[pk];builtins.remove(dbTable,position);}}});})(this);(function(){broke.extend({utils:{}});})();(function(){broke.extend(broke.utils,{functional:{lazy:function(fn,context){context=context||window;return function(){var args=Array.prototype.slice.call(arguments);return{toString:function(){return fn.apply(context,args);}};};}}});})();(function(){broke.extend({exceptions:{NotFound:function(message){return{name:"NotFound",message:message};},NotImplementedError:function(message){return{name:"NotImplementedError",message:message};},FieldError:function(message){return{name:"FieldError",message:message};},NoReverseMatch:function(message){return{name:"NoReverseMatch",message:message};},GenericError:function(message){return{name:"GenericError",message:message};},ImproperlyConfigured:function(message){return{name:"ImproperlyConfigured",message:message};},InvalidCacheBackendError:function(message){return{name:"InvalidCacheBackendError",message:message};},MultipleObjectsReturned:function(message){return{name:"MultipleObjectsReturned",message:message};},FieldDoesNotExist:function(message){return{name:"FieldDoesNotExist",message:message};},DoesNotExist:function(message){return{name:"DoesNotExist",message:message};},SettingsObjectNotDefined:function(message){return{name:"SettingsObjectNotDefined",message:message};},TemplateSyntaxError:function(message){return{name:"TemplateSyntaxError",message:message};},TemplateDoesNotExist:function(message){return{name:"TemplateSyntaxError",message:message};},TemplateEncodingError:function(message){return{name:"TemplateSyntaxError",message:message};},VariableDoesNotExist:function(message){return{name:"TemplateSyntaxError",message:message};}}});})();(function(){broke.extend(broke.core,{validators:{}});})();(function(){var
NoReverseMatch=broke.exceptions.NoReverseMatch;broke.extend({urlResolvers:{patterns:function(prefix){var
args=Array.prototype.slice.call(arguments);return builtins.map(args.slice(1),function(){if(typeof this[1]=="string"){this[1]=builtins.getattr(prefix+"."+this[1]);}
return this;});},include:function(urlObject){if(typeof urlObject=="string"){return builtins.getattr(urlObject);}
return urlObject;},parseQueryString:function(queryString){var result={};if(!queryString){return{};}
queryString=queryString.split('&');builtins.forEach(queryString,function(){var tmp=this.split('=');result[tmp[0]]=tmp[1];});return result;},parsePath:function(path){if(!path){return[];}
return path.split('/').slice(1);},resolve:function(url,args,urlPatterns){var
view=null,match=null,i,_this;urlPatterns=urlPatterns||broke.urlPatterns;args=args||[];for(i=0;i<urlPatterns.length;i++){_this=urlPatterns[i];match=url.match(_this[0]);if(match){if(match.length>1){args=args.concat(match.slice(1));}
view=_this[1];if(builtins.typeOf(view)=="string"){view=builtins.getattr(view);}
if(builtins.isFunction(view)){return[view,args];}else if(builtins.isArray(view)){url=url.replace(match[0],'');return broke.urlResolvers.resolve(url,args,view);}}}
throw broke.exceptions.NotFound(gettext.gettext('Matching url not found.'));},reverse:function(namedUrl,args,urlPatterns,result){var match=null,i,isInclude,_this;urlPatterns=urlPatterns||broke.urlPatterns;result=result||'';args=args||[];for(i=0;i<urlPatterns.length;i++){_this=urlPatterns[i];if(builtins.typeOf(_this[1])=="string"){_this[1]=builtins.getattr(_this[1]);}
isInclude=builtins.isArray(_this[1]);if(isInclude){match=builtins.startsWith(namedUrl,_this[2]);}else{match=(namedUrl==_this[2]);}
if(match){if(isInclude){namedUrl=namedUrl.replace(_this[2]+'-','');return broke.urlResolvers.reverse(namedUrl,args,_this[1],_this[0]);}else{result+=_this[0];result=builtins.interpolate(args,result.replace('^','').replace('$','').replace(/\(.*?\)/g,'%s'));if(result.match(_this[0])){return result;}else{return'';}}}}
throw NoReverseMatch(gettext.gettext('Matching url not found.'));return null;}}});})();(function(__global__){broke.bindToRequest(function(e,request,extraArgs,responseCallback){var
response={},view=null,callback,args=null,urlMatchResult=[],partialUrl,target,parseQueryString=broke.urlResolvers.parseQueryString,queryString={},resolve=broke.urlResolvers.resolve;extraArgs=extraArgs||[];request=broke.extend({completeUrl:window.location.href,method:'GET',fromReload:false,statusCode:200,META:{},GET:{},POST:{},REQUEST:{}},request);if(!request.url){return;}
partialUrl=request.url.split('?');if(partialUrl.length>1){request.url=partialUrl[0];queryString=parseQueryString(partialUrl[1]);request.GET=queryString;}else if('event'in request&&request.event.target.tagName.toLowerCase()==="form"){target=$(request.event.target);target.find('input,select,textarea').each(function(){var input=$(this);queryString[input.attr('name')]=input.val();});request.POST=queryString;}
request.REQUEST=queryString;request.META={HTTP_REFERER:window.location.href.split('#')[1]||''};builtins.forEach(broke.conf.settings.MIDDLEWARE_CLASSES,function(){var
middleware=builtins.getattr(this,__global__,{});if(middleware.processRequest!==undefined){middleware.processRequest.apply(this,[request].concat(extraArgs));}});try{urlMatchResult=resolve(request.url);}catch(error){if(error.name=="NotFound"){broke.response(response);return;}else{throw error;}}
if(urlMatchResult){view=urlMatchResult[0];args=urlMatchResult[1];if(extraArgs){args=args.concat(extraArgs);}
args.unshift(request);callback=function(response){response=broke.extend(request,response);broke.response(response,extraArgs,responseCallback);};args.push(callback);view.apply(this,args);}});broke.bindToResponse(function(e,response,extraArgs,responseCallback){extraArgs=extraArgs||[];builtins.forEach(response.additionalProperties,function(key){response.element[key]=this;});if(builtins.typeOf(response.callback)=='function'){response.callback.apply(response.element);}
builtins.forEach(broke.conf.settings.MIDDLEWARE_CLASSES.reverse(),function(){var
middleware=builtins.getattr(this,__global__,{});if(middleware.processResponse!==undefined){middleware.processResponse.apply(this,[response].concat(extraArgs));}});});})(window);broke.extend({contextProcessors:{debug:function(request){return{'debug':broke.conf.settings.DEBUG};},i18n:function(request){return{'languageCode':broke.conf.settings.LANGUAGE_CODE,'languages':keys(broke.conf.settings.LANGUAGES)};}}});(function(){var template=broke.template;broke.extend(template,{TOKEN_TEXT:0,TOKEN_VAR:1,TOKEN_BLOCK:2,TOKEN_COMMENT:3,_and:0,_or:1,FILTER_SEPARATOR:'|',FILTER_ARGUMENT_SEPARATOR:':',VARIABLE_ATTRIBUTE_SEPARATOR:'.',BLOCK_TAG_START:'{%',BLOCK_TAG_END:'%}',VARIABLE_TAG_START:'{{',VARIABLE_TAG_END:'}}',COMMENT_BLOCK_TAG_START:'{#',COMMENT_TAG_END:'#}',SINGLE_BRACE_START:'{',SINGLE_BRACE_END:'}',tagList:{},filterList:{},register:{tag:function(tagName,fn){broke.template.tagList[tagName]=fn;},filter:function(filterName,fn){broke.template.filterList[filterName]=fn;}},getVar:function(context,varstr){return builtins.getattr(varstr,context);}});Class.create({__name__:"broke.template.Template",__init__:function(tpl){this._nodelist=this._compile(tpl);},_compile:function(tpl){var tokens,tagStr=this._formRegx(),tagRe=new RegExp(tagStr,'g'),bits=[],originalBits=builtins.bsplit(tpl,tagRe);builtins.forEach(originalBits,function(){if(this!=""){bits.push(this);}});tokens=builtins.map(bits,function(){var tagToken;if(builtins.startsWith(this,template.BLOCK_TAG_START)){tagToken=this.slice(template.BLOCK_TAG_START.length,-template.BLOCK_TAG_END.length);return new template.Token(template.TOKEN_BLOCK,tagToken);}
else if(builtins.startsWith(this,template.VARIABLE_TAG_START)){return new template.Token(template.TOKEN_VAR,this.slice(template.VARIABLE_TAG_START.length,-template.VARIABLE_TAG_END.length));}else{return new template.Token(template.TOKEN_TEXT,this);}});return(new template.Parser(tokens)).parse();},_formRegx:function(){var ret='';ret+='('+builtins.rescape(template.BLOCK_TAG_START)+'.*?'+builtins.rescape(template.BLOCK_TAG_END)+'|'+builtins.rescape(template.VARIABLE_TAG_START)+'.*?'+builtins.rescape(template.VARIABLE_TAG_END)+'|$'+')';return ret;},render:function(context){var result=[];builtins.forEach(this._nodelist,function(){if(typeof(this)=='object'){typeof(this.render)=='function'?(result.push(this.render(context))):(result.push(this.toString()));}else{result.push(this.toString());}});return result.join('');}});broke.template.Template.listRender=function(context,nodelist){var result=[];builtins.forEach(nodelist,function(){result.push(this.render(context));});return result.join('');};Class.create({__parent__:window,__name__:"broke.template.Token",__init__:function(type,content){this.type=type;if(this.type!==template.TOKEN_TEXT){content=content.replace(/^\s+|\s+$/g,'');}
this.content=content;},tsplit:function(){}});})();(function(){var
tpl=broke.template,Template=tpl.Template,TemplateSyntaxError=broke.exceptions.TemplateSyntaxError,settings=broke.conf.settings;Class.create({__name__:"broke.template.VarNode",__init__:function(varstr){var
args=varstr.split(tpl.FILTER_SEPARATOR);this.varstr=args[0];this.filters=args.slice(1);this.content=null;},applyFilters:function(){var
_this=this;builtins.forEach(this.filters,function(){var args=this.split(tpl.FILTER_ARGUMENT_SEPARATOR)[1]||null;if(!(this in tpl.filterList)){broke.log('Filter not found, fail silently...');return;}
_this.content=tpl.filterList[this](_this.content,args);});return this;},render:function(context){this.content=builtins.getattr(this.varstr,context,"");if(this.filters){this.applyFilters();}
return this.content;}});Class.create({__name__:"broke.template.TextNode",__init__:function(str){this.str=str;},render:function(){return this.str;}});Class.create({__name__:"broke.template.CommentNode",__init__:function(str){this.str=str;},render:function(context){return'';}});Class.create({__name__:"broke.template.IfNode",__init__:function(linkType,boolPairs,nodeListTrue,nodeListFalse){this.linkType=linkType;this.boolPairs=boolPairs;this.nodeListTrue=nodeListTrue;this.nodeListFalse=nodeListFalse;},render:function(context){var
flag;if(this.linkType==tpl._and){flag=true;if(this.mapBoolpair(false,context)){flag=false;}}else{flag=false;if(this.mapBoolpair(true,context)){flag=true;}}
return flag?Template.listRender(context,this.nodeListTrue):Template.listRender(context,this.nodeListFalse);},mapBoolpair:function(tc,context){var
tmpbp='',bp=this.boolPairs,i,ilen;for(i=0,ilen=bp.length;i<ilen;i++){tmpbp=bp[i].split(' ');if(tmpbp.length==2&&tmpbp[0]=='not'){if(tc!=tpl.getVar(context,tmpbp[1])){return true;}}else{if(tc==tpl.getVar(context,tmpbp[0])){return true;}}}
return false;}});Class.create({__name__:"broke.template.IfEqualNode",__init__:function(vars,nodeListTrue,nodeListFalse){this.vars=vars;this.nodeListTrue=nodeListTrue;this.nodeListFalse=nodeListFalse;},render:function(context){var
flag=true,len=this.vars.length-1,currentVar,previousVar=tpl.getVar(context,this.vars.slice(-1)[0]);while(len--){currentVar=tpl.getVar(context,this.vars[len]);if(previousVar!=currentVar){flag=false;}
previousVar=currentVar;}
return flag?Template.listRender(context,this.nodeListTrue):Template.listRender(context,this.nodeListFalse);}});Class.create({__name__:"broke.template.ForNode",__init__:function(loopvar,sequence,reversed,nodeListLoop){this.loopvar=loopvar;this.sequence=sequence.split('.');this.reversed=reversed;this.nodeListLoop=nodeListLoop;},render:function(context){var
ret=[],parentloop,items=context,k,i,klen,ilen;if(context.forloop){parentloop=context.forloop;}
for(k=0,klen=this.sequence.length;k<klen;k++){items=items[this.sequence[k]];}
if(!(items instanceof Array)){throw TemplateSyntaxError(gettext.gettext('values is not a array'));}
if(this.reversed){items=items.reverse();}
for(i=0,ilen=items.length;i<ilen;i++){context.forloop={'counter0':i,'counter':i+1,'revcounter':ilen-i,'revcounter0':ilen-i-1,'first':(i==0),'last':(i==(ilen-1)),'parentloop':parentloop};context[this.loopvar]=items[i];ret.push(Template.listRender(context,this.nodeListLoop));}
context.forloop=undefined;return ret.join('');}});Class.create({__name__:"broke.template.UrlNode",__init__:function(viewName,args,asVar){this.viewName=viewName;this.args=args;this.asVar=asVar;},render:function(context){var
reverse=broke.urlResolvers.reverse,args=[],projectName;builtins.forEach(this.args,function(){var thisVar=builtins.getattr(this,context);if(thisVar===undefined){thisVar=this.asInt();if(typeOf(thisVar)=="NaN"){thisVar=this;}}
args.push(thisVar);});try{url=reverse(this.viewName,args);}catch(e){if(e.name=="NoReverseMatch"){projectName=settings.SETTINGS_MODULE.split('.')[0];url=reverse(projectName+this.viewName,args);}}
if(this.asVar){context[this.asVar]=url;return''}
return url;}});})();(function(){var
tpl=broke.template,TemplateSyntaxError=broke.exceptions.TemplateSyntaxError;Class.create({__parent__:window,__name__:"broke.template.Parser",__init__:function(tokens){this.tokens=tokens;},parse:function(parseUntil){var
nodelist=[],token=null,tagFuncName=null,tagFunc=null;if(!parseUntil){parseUntil=[];}
if(!(parseUntil instanceof Array)){parseUntil=[parseUntil];}
while(this.tokens.length){token=this.tokens.shift();if(token.type==tpl.TOKEN_TEXT){nodelist.push(new tpl.TextNode(token.content));}
else if(token.type==tpl.TOKEN_VAR){nodelist.push(new tpl.VarNode(token.content));}
else if(token.type==tpl.TOKEN_BLOCK){if(builtins.has(parseUntil,token.content)){this.prependToken(token);return nodelist;}
tagFuncName=token.content.split(/\s+/)[0];if(!tagFuncName){throw TemplateSyntaxError(gettext.gettext('Empty Tag'));}
tagFunc=tpl.tagList[tagFuncName];if(!tagFunc){throw TemplateSyntaxError(gettext.gettext('Unknow Tag'));}
nodelist.push(tagFunc(this,token));}}
return nodelist;},skipPast:function(endtag){var
token=null;while(this.tokens.length){token=this.tokens.shift();if(token.type==tpl.TOKEN_BLOCK&&token.content==endtag){return;}}
throw TemplateSyntaxError(gettext.gettext('Not Closed Tag'));},prependToken:function(token){this.tokens.unshift(token);},nextToken:function(){return this.tokens.shift();},deleteFirstToken:function(){this.tokens.shift();return true;}});})();(function(){var
tpl=broke.template,register=tpl.register,TemplateSyntaxError=broke.exceptions.TemplateSyntaxError;register.tag('if',function(parser,token){var
bits=token.content.split(/\s+/),linkType,nodeListTrue,nodeListFalse,bitstr,boolPairs;bits.shift();if(!bits){throw TemplateSyntaxError(gettext.gettext('If node need at least one args'));}
bitstr=bits.join(' ');boolPairs=bitstr.split(' or ');if(boolPairs.length==1){linkType=tpl.IfNode._and;boolPairs=bitstr.split(' and ');}else{linkType=tpl.IfNode._or;if(bitstr.indexOf(' and ')!=-1){throw TemplateSyntaxError(gettext.gettext('If node do not allow mix "and" & "or"'));}}
nodeListTrue=parser.parse(['else','endif']);token=parser.nextToken();if(token.content.indexOf('else')!=-1){nodeListFalse=parser.parse('endif');parser.deleteFirstToken();}else{nodeListFalse=[];}
return new tpl.IfNode(linkType,boolPairs,nodeListTrue,nodeListFalse);});register.tag('ifequal',function(parser,token){var
bits=token.content.split(/\s+/),nodeListTrue,nodeListFalse,bitstr,boolPairs;bits.shift();if(bits.length<2){throw TemplateSyntaxError(gettext.gettext('Ifequal node need at least two args'));}
nodeListTrue=parser.parse(['else','endifequal']);token=parser.nextToken();if(token.content.indexOf('else')!=-1){nodeListFalse=parser.parse('endifequal');parser.deleteFirstToken();}else{nodeListFalse=[];}
return new tpl.IfEqualNode(bits,nodeListTrue,nodeListFalse);});register.tag('comment',function(parser,token){parser.skipPast('endcomment');return new tpl.CommentNode();});register.tag('for',function(parser,token){var
bits=token.content.split(/\s+/),loopvar=bits[1],sequence=bits[3],reversed=(bits.length==5),nodeListLoop=parser.parse('endfor');if(bits.length==5&&bits[4]!='reversed'){throw TemplateSyntaxError(gettext.gettext('The 4 args of for tag must be reversed'));}
if(!builtins.has([4,5],bits.length)){throw TemplateSyntaxError(gettext.gettext('The for tag should have 4 or 5 args'));}
if(bits[2]!='in'){throw TemplateSyntaxError(gettext.gettext('The 2nd args of for tag must be "in"'));}
parser.deleteFirstToken();return new tpl.ForNode(loopvar,sequence,reversed,nodeListLoop);});register.tag('url',function(parser,token){var
bits=token.content.split(/\s+/),viewName=bits[1],args=bits[2].split(','),asVar;if(bits.length==5){if(bits[3]!='as'){throw TemplateSyntaxError(gettext.gettext('The 3 args of for tag must be "as"'));}
asVar=bits[3];}
return new tpl.UrlNode(viewName,args,asVar);});})();(function(){var
defaultFilters={add:function(value){return value.asInt()+value.asInt();},addslashes:function(value){return value.replace('\\','\\\\').replace('"','\\"').replace("'","\\'");},capfirst:function(value){return value[0].upper()+value.slice(1).toLowerCase();},center:function(value,args){return center(value,args.asInt());},cut:function(value,args){return value.replace(args,'');},date:function(value,args){if(typeOf(value)!='date'){value=new Date(value);}
return value.format(args);},'default':function(value,args){return value==''?args:value;},default_if_null:function(value,args){return value===null?args:value;},dictsort:function(value){return value;},dictsortreversed:function(value){return value;},divisibleby:function(value,args){return value.asInt()&&args.asInt();},escape:function(value){var baseEscapes=[['<','&lt;'],['>','&gt;'],["'",'&#39;'],['"','&quot;'],['&','&amp;']];builtins.forEach(baseEscapes,function(){var bad=this[0],good=this[1];value.replace(bad,good);});return value;},escapejs:function(value){var baseJsEscapes=[['\\','\x5C'],['\'','\x27'],['"','\x22'],['>','\x3E'],['<','\x3C'],['&','\x26'],['=','\x3D'],['-','\x2D'],[';','\x3B'],['\u2028','\u2028'],['\u2029','\u2029']];builtins.forEach(baseJsEscapes,function(){var bad=this[0],good=this[1];value.replace(bad,good);});return value;},filesizeformat:function(bytes){var KB=1024,MB=KB*1024,GB=MB*1024;bytes=bytes.asInt();if(bytes<KB){return gettext.ngettext("%(size)d byte","%(size)d bytes",bytes).interpolate({size:bytes});}
if(bytes<MB){return builtins.interpolate(gettext.gettext('%s KB'),bytes/KB);}
if(bytes<GB){return builtins.interpolate(gettext.gettext('%s MB'),bytes/MB);}
return builtins.interpolate(gettext.gettext('%s GB'),bytes/GB);},first:function(list){return list[0];},fix_ampersands:function(value){return value.replace('&','&amp;');},floatformat:function(value,args){value=value.split('.');args=value[1][args];return value[0]+args;},force_escape:function(value){return this.escape(value);},get_digit:function(value){var start=value*-1,end=start+1;return value.slice(start,end);},iriencode:function(value){return value;},join:function(list,args){return list.join(args);},last:function(value){return value.last();},length:function(value){return value.length;},length_is:function(value,args){return value.length==args.asInt();},linebreaks:function(value){return value;},linebreaksbr:function(value){return value.replace(/\n/g,'<br/>');},linenumbers:function(value){var numLines,i,result=[];value=value.split('\n');numLines=value.length;for(i=0;i<numLines;i++){result.push((i+1)+'. '+value[i]);}
return result.join('');},ljust:function(value,spaces){spaces=spaces.asInt()-value.length;if(spaces){value=value.split('');while(spaces--){value.push(' ');}}
return value.join('');},lower:function(value){return value.toLowerCase();},make_list:function(value){if(typeOf(value)=="number"){value=new String(value);return builtins.map(value.split(''),function(){return this.asInt();});}
return value.split('');},phone2numeric:function(value){return value;},pluralize:function(value,suffix){var suffixes=suffix.split(','),singularSuffix,pluralSuffix;if(suffixes.length>1){singularSuffix=suffixes[0];pluralSuffix=suffixes[1];}else{pluralSuffix=suffixes[0];singularSuffix='';}
if(value.length>1){return pluralSuffix;}
return singularSuffix;},pprint:function(value){return value;},random:function(list){return list;},removetags:function(value,tags){builtins.forEach(tags.split(' '),function(){value.replace('<'+this+'>','').replace('</'+this+'>','');});return value;},rjust:function(value,spaces){spaces=spaces.asInt()-value.length;if(spaces){while(spaces--){value+=' ';}}
return value;},safe:function(value){return value;},safeseq:function(list){var _this=this;return builtins.map(list,function(){return _this.save(this);});},slice:function(list,args){args=args.split(',');if(args.length>1){return list.slice(args[0].asInt(),args[1].asInt());}
return list.slice(args[0].asInt());},slugify:function(value){return builtins.slugify(value);},stringformat:function(value,args){return value;},striptags:function(value){return value.replace(/<[a-zA-Z_]>/g,'').replace(/<\/[a-zA-Z_]>/g,'');},time:function(value){return value;},timesince:function(value){return value;},timeuntil:function(value){return value;},title:function(value){return value.capitalize();},truncatewords:function(value,numberOfWords){return value.split(' ').slice(0,numberOfWords).join('')+'...';},truncatewords_html:function(value){return value;},unordered_list:function(list){var createUl=function(list){var newUl=[];builtins.forEach(list,function(){if(typeOf(this)=="array"){newUl.push('<ul>');newUl.push(createUl(this));newUl.push('</ul>');}
newUl.push('<li>');newUl.push(this);newUl.push('</li>');});return newUl.join('');};return createUl(list);},upper:function(value){return value.upper();},urlencode:function(value){return value;},urlize:function(value){return value;},urlizetrunc:function(value){return value;},wordcount:function(value){return value.split(' ').length;},wordwrap:function(value,args){return value;},yesno:function(value,args){args=args.split(',');var yes=args[0],no=args[1],maybe=args[2]||no;if(value===null){return maybe;}else if(value){return yes;}
return no;}};broke.extend(broke.template,{defaultFilters:defaultFilters});broke.extend(broke.template,{filterList:defaultFilters});})();(function(){var templatesCache={},settings=broke.conf.settings;broke.extend(broke.template,{loaders:{apps:{loadTemplate:function(templateName){var template,len=settings.INSTALLED_APPS.length,result,app;while(len--){app=settings.INSTALLED_APPS[len];if(app){if(app.templates!==undefined&&templateName in app.templates){return app.templates[templateName];}}}
return template;}},remote:{loadTemplate:function(templateName){var template,url,templatePath,len=settings.TEMPLATE_PATHS.length;while(len--){templatePath=settings.TEMPLATE_PATHS;url=templatePath+'/'+templateName;if(url in templatesCache){return templatesCache[url];}
$.ajax({async:false,url:url,success:function(responseText){template=responseText;templatesCache[url]=template;},error:function(error){}});}
return template;}}}});})();(function(){var Template=broke.template.Template;broke.extend(broke.template,{loader:{renderToString:function(templateName,context){var i,loader,template;for(i=0;i<broke.conf.settings.TEMPLATE_LOADERS.length;i++){loader=broke.conf.settings.TEMPLATE_LOADERS[i];if(builtins.typeOf(loader)=="string"){loader=builtins.getattr(loader);}
if((template=loader.loadTemplate(templateName))){break;}};if(template){return new Template(template).render(context);}
return'';}}});})();broke.extend(broke.conf.settings,{AJAX:{dataType:'json',async:false,cache:false},API_BASE_URL:'/api/',BASE_URL:'/broke',CACHE_BACKEND:'localStorage://',CACHE_MIDDLEWARE_SECONDS:600,CACHE_MIDDLEWARE_KEY_PREFIX:'',DATABASES:{'default':{NAME:'',ENGINE:'broke.db.engines.LocalEngine',USER:'',PASSWORD:''},'remote':{NAME:'',ENGINE:'broke.db.engines.RemoteEngine',USER:'',PASSWORD:'',BASE_URL:'/api/'}},DATABASE_ROUTERS:['mmds.routers.DefaultRouter'],DISALLOWED_USER_AGENTS:[],DEBUG:false,CONTEXT_PROCESSORS:['broke.contextProcessors.debug'],DATE_FORMAT:'dd-mm-yy',EVENT_BINDING:'live',EVENT_TRIGGERING_METHOD:'elements',FORM:null,GET_LATEST_BY:'pk',HANDLER_404:'broke.views.defaults.pageNotFound',HASHCHANGE_INTERVAL:150,HIDE_HASH:false,JSON_URLS:null,LOCALE_PATHS:[],LANGUAGE_CODE:'en',LANGUAGES:{'en':'English','it':'Italian'},LANGUAGE_COOKIE_NAME:'broke_language',MIDDLEWARE_CLASSES:['broke.middleware.common.CommonMiddleware'],PREVENT_DEFAULT:false,PRELOAD_REMOTE_TEMPLATES:false,QUERY_TYPE:'local',RETURN:location.href,ROOT_URLCONF:null,STOP_PROPAGATION:false,SAVE:{async:false,cache:false,commit:true},TEMPLATE_STRING_IF_INVALID:'',TEMPLATE_PATHS:[],TEMPLATE_LOADERS:['broke.template.loaders.apps'],URL_CHANGING_ELEMENTS:{'a':{events:['click'],urlAttribute:'href'},'form':{events:['submit'],urlAttribute:'action',preventDefault:true}},USE_AJAX:true,USE_I18N:false});(function(){var
settings=broke.conf.settings,NotImplementedError=broke.exceptions.NotImplementedError,BaseEngine,LocalEngine,OPERATIONS={SELECT:'select',INSERT:'insert',UPDATE:'update',DELETE:'delete'},filterOperations={contains:function(first,second){if(first.match(second)){return true;}
return false;},iContains:function(first,second){return this.contains(first.toString().toLowerCase(),second.toString().toLowerCase());},startsWith:function(first,second){if(first.match("^"+second)){return true;}
return false;},iStartsWith:function(first,second){return this.startsWith(first.toString().toLowerCase(),second.toString().toLowerCase());},endsWith:function(first,second){if(first.match(second+"$")){return true;}
return false;},iEndsWith:function(first,second){return this.EndsWith(first.toString().toLowerCase(),second.toString().toLowerCase());},exact:function(first,second){if(first.match("^"+second+"$")){return true;}
return false;},iExact:function(first,second){return this.exact(first.toString().toLowerCase(),second.toString().toLowerCase());},'in':function(first,second){return builtins.has(second,first);},gt:function(first,second){return first>second;},gte:function(first,second){return first>=second;},lt:function(first,second){return first<second;},lte:function(first,second){return first<=second;},regex:function(first,second){return first.match(second);},iRegex:function(first,second){return this.regex(first.toString().toLowerCase(),second.toString().toLowerCase());},isNull:function(first,second){return(first===null||first===undefined)?second:!second;},year:function(first,second){return(new Date(first).getFullYear())==second;},month:function(first,second){return(new Date(first).getMonth()+1)==second;},day:function(first,second){return(new Date(first).getDate())==second;},weekDay:function(first,second){return(new Date(first).getDay())==second;},range:function(first,second){return(second[0]<=first)&&(first<=second[1]);}},applyFilters=function(engine,data,args,negate){var
Model=broke.db.models.Model;negate=negate===undefined?true:negate;return builtins.filter(data,function(){var
splitData=null,filterOperation=null,key=null,newKey=null,relatedObjectFilterOptions={},relatedResult,value,data=this;for(key in args){if(args.hasOwnProperty(key)){splitData=key.split('__');if(splitData.length>1){newKey=splitData[0];filterOperation=splitData[1];if(filterOperation in filterOperations){if(!filterOperations[filterOperation](this.fields[newKey],args[key])){return!negate;}}else if(builtins.typeOf(this.fields[newKey])=="object"){try{relatedResult=builtins.getattr(splitData.join('.'),this.fields,null);if(relatedResult==args[key]){return negate;}}catch(e){}
return!negate;}else{throw broke.exceptions.NotImplementedError(builtins.interpolate(gettext.gettext("Filter operation '%s' not implemented."),filterOperation));}}else if(args[key]instanceof Model&&this.fields[key]instanceof Model){try{if(args[key].pk!=this.fields[key].pk){return!negate;}}catch(e){}
return negate;}else if(key=="pk"&&this[key]==args[key]){return negate;}else if(this.fields[key]!=args[key]){return!negate;}}}
return negate;});},saveRelatedObjectsOnLocalEngine=function(objects){builtins.forEach(objects,function(){var
object=this;builtins.forEach(this.fields,function(key){var
relatedField;if(builtins.typeOf(this)=="array"){relatedField=object[key];if(relatedField){builtins.forEach(this,function(){LocalEngine({model:relatedField.model,args:{insert:this},operation:OPERATIONS.INSERT}).execute();});}}});});};broke.db.engines={OPERATIONS:OPERATIONS};BaseEngine=Class.create({__name__:"broke.db.engines.BaseEngine",__init__:function(kwargs){this.model=kwargs.model;this.args=kwargs.args;this.operation=kwargs.operation;this.settings=kwargs.settings;this.object=kwargs.object;},select:function(){throw NotImplementedError("You need to implement this method on every class that extends this one.");},insert:function(){throw NotImplementedError("You need to implement this method on every class that extends this one.");},update:function(){throw NotImplementedError("You need to implement this method on every class that extends this one.");},'delete':function(){throw NotImplementedError("You need to implement this method on every class that extends this one.");},execute:function(callback){var
engine=this,executeCallback=function(operationResult,status,xhr,error){var
result;if(operationResult&&builtins.typeOf(operationResult)=="array"){result=builtins.map(operationResult,function(){return engine.model(this);});saveRelatedObjectsOnLocalEngine(result);}else if(builtins.typeOf(operationResult)=="object"){result=engine.model(operationResult);saveRelatedObjectsOnLocalEngine([result]);}
if(callback){callback(result,status,xhr,error);}};return this[this.operation](executeCallback);}});LocalEngine=BaseEngine.create({__name__:"broke.db.engines.LocalEngine",select:function(callback){var
data=broke.storage[this.model.getTableName()];data=applyFilters(this,data,this.args.filter);data=applyFilters(this,data,this.args.exclude,true);callback(data);},insert:function(callback){var
engine=this,objects,dataTableName=this.model.getTableName(),data;if(builtins.typeOf(this.args.insert)=="array"){data=[];builtins.forEach(this.args.insert,function(){data.push(broke.schema.set(dataTableName,this));});}else{data=broke.schema.set(dataTableName,this.args.insert);}
callback(data);},update:function(callback){return this.insert(callback);},'delete':function(callback){},orderBy:function(){return this;}});RemoteEngine=BaseEngine.create({__name__:"broke.db.engines.RemoteEngine",select:function(callback){return this._ajaxOperation({data:this.args.filter,type:'GET'},callback);},insert:function(callback){return this._ajaxOperation({data:this.args.insert.fields,type:'POST',success:function(data,status,xhr){data=builtins.typeOf(data)=="array"?data[0]:data;if(callback){callback(data,status,xhr,null);}}},callback);},update:function(callback){return this._ajaxOperation({data:this.args.update,type:'PUT',url:this.object.remoteUrls.update,success:function(data,status,xhr){data=builtins.typeOf(data)=="array"?data[0]:data;if(callback){callback(data,status,xhr);}}},callback);},'delete':function(callback){return this._ajaxOperation({type:'DELETE',url:this.object.remoteUrls['delete']},callback);},orderBy:function(){},_ajaxOperation:function(ajaxSettings,callback){ajaxSettings=builtins.extend({async:this.settings.async,cache:this.settings.cache===undefined?false:this.settings.cache,url:this.model.getBaseRemoteUrl(),success:function(data,status,xhr){if(callback){callback(data,status,xhr);}},error:function(xhr,status,error){if(callback){callback(null,status,xhr,error);}}},ajaxSettings);return $.ajax(ajaxSettings);}});})();(function(){var
QuerySet,engineOperations=broke.db.engines.OPERATIONS,settings=broke.conf.settings;QuerySet=Class.create({__name__:"broke.db.models.QuerySet",__init__:function(kwargs){var
routers=settings.DATABASE_ROUTERS,routersLen=routers.length,i,dbForRead,dbForWrite,router;this.model=kwargs.model;this.db=kwargs.db;this.args={filter:{},exclude:{},insert:{},orderBy:{},'delete':{}};this._settings=kwargs.settings||{};builtins.extend(this.args,kwargs.args);if(this.db){this.dbForRead=this.db;this.dbForWrite=this.db;}else{this.dbForRead=broke.db.models.getDbForReadFromModel(this.model);this.dbForWrite=broke.db.models.getDbForWriteFromModel(this.model);}
this.engineForRead=builtins.getattr(settings.DATABASES[this.dbForRead].ENGINE);this.engineForWrite=builtins.getattr(settings.DATABASES[this.dbForWrite].ENGINE);},settings:function(settings){builtins.extend(this._settings,settings);return this;},exclude:function(args){this.args.exclude=args;return this.__class__({model:this.model,args:this.args,settings:this._settings,db:this.db});},filter:function(args){this.args.filter=args;return this.__class__({model:this.model,args:this.args,settings:this._settings,db:this.db});},create:function(args,callback){if(builtins.typeOf(args)=="function"){callback=args;args=undefined;}
this.args.insert=args;this.engineForWrite({operation:engineOperations.INSERT,model:this.model,args:this.args,settings:this._settings}).execute(callback);},getOrCreate:function(args,callback){try{return this.get(args,callback);}catch(e){if(e.name=='DoesNotExist'){return this.create(args);}
throw e;}},get:function(args,callback){var
querySet=this,getCallback=function(object){if(object.length>1){throw broke.exceptions.MultipleObjectsReturned(builtins.interpolate(gettext.gettext("get() returned few %s instances -- it returned %s! Lookup parameters were %s"),querySet.model.__name__,object.length,args));}
if(!object.length){throw broke.exceptions.DoesNotExist(builtins.interpolate(gettext.gettext("%s matching query does not exist."),querySet.model.__name__));}
if(callback){callback(object[0]);}};if(callback===undefined){callback=args;args=undefined;}
if(args){this.filter(args).all(getCallback);}else{this.all(getCallback);}},latest:function(field,callback){if(callback===undefined){callback=field;field=undefined;}
field=field||settings.GET_LATEST_BY;return this.orderBy(field).all(callback)[0];},orderBy:function(fields){if(builtins.typeOf(fields)=="string"){fields=[fields];}
this.args.orderBy=fields;return this.__class__({model:this.model,args:this.args,settings:this._settings,db:this.db});},all:function(settings,callback){if(callback===undefined){callback=settings;settings=undefined;}
this.engineForRead({operation:engineOperations.SELECT,model:this.model,args:this.args,settings:this._settings}).execute(callback);},'delete':function(callback){this.engineForWrite({operation:engineOperations.DELETE,model:this.model,args:this.args,settings:this._settings}).execute(callback);}});})();(function(){var
LocalQuerySet=broke.db.models.LocalQuerySet
RemoteQuerySet=broke.db.models.RemoteQuerySet,QUERY_TYPE=broke.conf.settings.QUERY_TYPE;Class.create({__parent__:window,__name__:"broke.db.models.Manager",__init__:function(model){this.model=model;},all:function(callback){return this.getQuerySet().all(callback);},create:function(args,callback){return this.getQuerySet().create(args,callback);},exclude:function(args){return this.getQuerySet().exclude(args);},filter:function(args){return this.getQuerySet().filter(args);},get:function(args,callback){return this.getQuerySet().get(args,callback);},getOrCreate:function(args,callback){return this.getQuerySet().getOrCreate(args,callback);},getQuerySet:function(){return new broke.db.models.QuerySet({model:this.model,db:this.db});},settings:function(settings){return this.getQuerySet().settings(settings);},latest:function(args,callback){return this.getQuerySet().latest(args,callback);},using:function(db){this.db=db;return this;}});})();(function(){var
Model,models=broke.db.models,Manager=models.Manager,elementsCache={};builtins.extend(broke.db.models,{getDbFromModel:function(operation,model){var
routers=broke.conf.settings.DATABASE_ROUTERS,routersLen=routers.length,db;for(i=0;i<routersLen;i++){router=builtins.getattr(routers[i])();db=router[operation](model);if(db){return db;}}
return'default';},getDbForReadFromModel:function(model){return broke.db.models.getDbFromModel('dbForRead',model);},getDbForWriteFromModel:function(model){return broke.db.models.getDbFromModel('dbForWrite',model);},getModel:function(appLabel,modelName){return broke.contentTypeCache[appLabel][modelName];},compareObjects:function(firstObject,secondObject){if(firstObject.__class__.__fullname__==secondObject.__class__.__fullname__&&firstObject.pk==secondObject.pk){return true;}
return false;}});Class.create({__name__:"broke.db.models.ModelMetaClass",__init__:function(__class__){var
defaultManager;__class__.objects=Manager(__class__);__class__.appLabel=__class__.__fullname__.split('.').slice(-3,-2)[0];builtins.forEach(__class__.prototype,function(key){if(this instanceof Manager&&defaultManager===undefined){defaultManager=this;}
if(this.contributeToClass){this.contributeToClass(__class__,key);}});__class__._defaultManager=defaultManager||__class__.objects;},DoesNotExist:broke.exceptions.DoesNotExist,MultipleObjectsReturned:broke.exceptions.MultipleObjectsReturned,getTableName:function(){if(!this._tableName){this._tableName=[this.appLabel,this.__name__.toLowerCase()].join('_');if(!broke.storage[this._tableName]){broke.storage[this._tableName]=[];}}
return this._tableName;},getObjectFromElement:function(element,callback){var
model,objectPk=element.attr('data-pk'),appLabel=element.attr('data-app_label'),model=this.__name__.toLowerCase();models.getModel(appLabel,model)._defaultManager.getOrCreate({pk:objectPk},callback);},getBaseRemoteUrl:function(){if(!this._remoteBaseUrl){this._remoteBaseUrl=broke.conf.settings.API_BASE_URL+this.__name__.toLowerCase()+'/'}
return this._remoteBaseUrl;}});Model=Class.create({__name__:"broke.db.models.Model",__metaclass__:broke.db.models.ModelMetaClass,__init__:function(args,inheritedFields){var
baseUrl=this.__class__.getBaseRemoteUrl(),currentInstance=this,tmpArgs,key;if(args.fields===undefined){tmpArgs={};tmpArgs.fields=args;tmpArgs.pk=args.pk||args.id;args=tmpArgs;}
broke.extend(this,args||{});if(this.pk){this.fields.pk=this.pk;}
this.remoteUrls={get:baseUrl,save:baseUrl,update:baseUrl+this.pk+'/','delete':baseUrl+this.pk+'/'};},fields:{},elements:function(kwargs){var
extraFilter,context=document,clearCache,elements,filterExpression;if(kwargs){extraFilter=kwargs.filter||'';context=kwargs.context||document;clearCache=kwargs.clearCache;filterExpression=kwargs.filterExpression||'';}else{filterExpression='[data-pk="'+this.fields.pk+'"]'+'[data-app_label="'+this.__class__.appLabel+'"]'+'[data-model="'+this.__class__.__name__.toLowerCase()+'"]';}
clearCache=clearCache===undefined?false:clearCache;if(!elementsCache[filterExpression]){clearCache=true;}
if(clearCache){elements=$(filterExpression,context);if(extraFilter){elements=elements.filter(extraFilter);}
elementsCache[filterExpression]=elements;}
return elementsCache[filterExpression];},getForm:function(formSetParent){if(!this.form){this.form=broke.forms.Form({instance:this,formSetParent:formSetParent});}
return this.form;},getAbsoluteUrl:function(){return'';},getOperation:function(del){if(del!==undefined&&this.fields.pk){return'delete';}
else if(this.fields.pk){return'update';}
return'create';},processFields:function(){var
data={};builtins.forEach(this.fields,function(key){if(this instanceof Model){data[key]=this.pk.toString();}else if(builtins.typeOf(this)=="object"&&(this.pk||this.id)){data[key]=this.pk||this.id;}else if(builtins.startsWith(key,'_')){return;}else if(this!==undefined){data[key]=this.toString();}});return data;},update:function(fields,saveSettings,callback){builtins.extend(this.fields,fields);return this;},save:function(saveSettings,callback){var
object=this,className=object.__class__.__name__.toLowerCase(),operation,serverOperation,apiBaseUrl=broke.conf.settings.API_BASE_URL,operationsMap={'save':'POST','update':'PUT','delete':'DELETE'},data={},created=true,overrideLocalData,using,dbForWrite,engineForWrite,engineOperation='insert',engineOperationArgs={insert:{},update:{},'delete':{}};if(builtins.typeOf(saveSettings)=='function'){callback=saveSettings;saveSettings={};}
saveSettings=saveSettings||{};url=saveSettings.url||apiBaseUrl+className+'/';overrideLocalData=saveSettings.overrideLocalData===undefined?true:saveSettings.overrideLocalData;dbForWrite=saveSettings.using;saveSettings=broke.extend(builtins.clone(broke.conf.settings.SAVE),saveSettings);operation=saveSettings.operation?'delete':'save';broke.$window.trigger('broke.'+className+'.pre_'+operation,[object]);if(operation=='save'&&object.pk){serverOperation='update';engineOperation='update';}else if(operation=='save'){engineOperation='insert';}else if(operation=='delete'&&!object.pk){}else{serverOperation=operation;engineOperation=operation;}
if(this.pk&&operation!='save'){url+=object.pk+'/';}
data=this.processFields();engineOperationArgs[engineOperation]=data;dbForWrite=dbForWrite!==undefined?dbForWrite:broke.db.models.getDbForWriteFromModel(this.__class__);engineForWrite=builtins.getattr(broke.conf.settings.DATABASES[dbForWrite].ENGINE);this.fields._deleted=true;if(saveSettings.commit){return engineForWrite({operation:engineOperation,model:this.__class__,object:this,args:engineOperationArgs,settings:saveSettings}).execute(function(data,status,xhr,error){broke.$window.trigger('broke.'+className+'.post_'+engineOperation,[object]);if(callback){callback(data);}});}},'delete':function(settings,callback){if(builtins.typeOf(settings)=="function"){callback=settings;settings={};}
settings=settings||{};this.fields._deleted=true;settings.operation='delete';return this.save(settings,callback);}});})();(function(){var
Field,ForeignKey,CharField,TextField,getter=function(){},setter=function(){};Field=Class.create({__name__:"broke.db.fields.Field",attachCurrentModelInstance:true,contributeToClass:function(cls,fieldName){this.model=cls;this.fieldName=fieldName;}});ForeignKey=Field.create({__name__:"broke.db.fields.ForeignKey",__init__:function(kwargs){this.relatedModel=kwargs.model;if(kwargs.relatedName){this.relatedName=kwargs.relatedName;}},contributeToClass:function(cls,fieldName){this._super(cls,fieldName);this.contributeToRelatedClass(cls,fieldName);},contributeToRelatedClass:function(cls,fieldName){var
fieldInstance=this,getRelatedModels=function(){return cls.objects.filter({pk:this.fields[fieldName]});};if(!this.relatedName){this.relatedName=cls.__name__.toLowerCase()+'_set';}
this.relatedModel.prototype[this.relatedName]=getRelatedModels;getRelatedModels.model=cls;},__call__:function(instance,callableObject,callback){var
pk=instance.fields[callableObject.fieldName]||instance.fields[callableObject.fieldName+'_id'];this.relatedModel.objects.get({pk:pk},callback);}});PositiveIntegerField=Field.create({__name__:"broke.db.fields.PositiveIntegerField",__call__:function(instance,callableObject,value){if(value!==undefined){if(value<0||parseInt(value)===NaN){throw new Error("A PositiveIntegerField only accepts a positive integer field.");}
instance.fields[callableObject.fieldName]=value;}else{value=instance.fields[callableObject.fieldName];}
return value;}});TextField=Field.create({__name__:"broke.db.fields.TextField",__call__:function(instance,callableObject,value){if(value!==undefined){instance.fields[callableObject.fieldName]=value;}else{value=instance.fields[callableObject.fieldName];}
return value;}});CharField=TextField.create({__name__:"broke.db.fields.CharField",__init__:function(kwargs){this.max_length=kwargs.max_length;},__call__:function(instance,callableObject,value){if(value!==undefined){if(value.length>this.max_length){throw new Error("Value exceeds set max length");}
instance.fields[callableObject.fieldName]=value;}else{value=instance.fields[callableObject.fieldName];}
return value;}});builtins.extend(broke.db.models,broke.db.fields);})();(function(){var
saveAsAjaxRequest=function(data){var result;$.ajax({async:false,method:'POST',data:data,success:function(status){result=status;},error:function(status){result=status;}});return result;},saveAsFormPost=function(data){var
form=$('<form action="." method="post" style="display:none;"></form>'),field=$('<textarea></textarea>'),newField;builtins.forEach(data,function(key){newField=field.clone();newField.attr('name',key);if(builtins.typeOf(this)=="boolean"){if(this==true){newField.val('on');form.append(newField);}}else if(builtins.typeOf(this)=="array"){builtins.forEach(this,function(){newField=field.clone();newField.val(this);newField.attr('name',key);form.append(newField);});}else{newField.val(this);form.append(newField);}});form.appendTo('body').submit();return form;};Class.create({__name__:"broke.forms.Form",__init__:function(kwargs){builtins.extend(this,kwargs);},save:function(settings){var
useAjax=settings.useAjax||broke.conf.settings.useAjax,result,prefix=settings.prefix||'',form=this,data={};builtins.forEach(this.instance.getData(),function(key){data[prefix+key]=this;});if(this.formSetParent){return data;}else if(useAjax){result=saveAsAjaxRequest(data);}else{result=saveAsFormPost(data);}
return result;}});Class.create({__name__:"broke.forms.FormSet",__init__:function(kwargs){builtins.extend(this,kwargs);},save:function(settings){var
useAjax,result,data={},commit,count=0,formSet=this;settings=settings||{};commit=settings.commit||false;data[this.prefix+'-TOTAL_FORMS']=this.forms.length;data[this.prefix+'-INITIAL_FORMS']=this.initialForms;broke.extend(data,this.instance.getData());builtins.forEach(this.forms,function(){broke.extend(data,this.save({prefix:formSet.prefix+'-'+count+'-'}));count+=1;});if(settings.extraData){broke.extend(data,settings.extraData);}
if(useAjax){result=saveAsAjaxRequest(data);}else{result=saveAsFormPost(data);}
return result;}});})();(function(){var
applyContextProcessors=function(response){builtins.forEach(broke.conf.settings.CONTEXT_PROCESSORS,function(){var contextProcessor=builtins.getattr(this);broke.extend(response.context,contextProcessor(response));});return response.context;},renderToString=broke.template.loader.renderToString;broke.extend(broke.shortcuts,{node:{create:function(response){var
allowedMethods=['after','before','append','prepend','wrap'],context=applyContextProcessors(response),renderedTemplate=renderToString(response.template,context),newElement=$(renderedTemplate);response=broke.extend({method:'append',htmlNode:'body'},response);if(!builtins.has(allowedMethods,response.method)){throw broke.exceptions.NotImplementedError(builtins.interpolate(gettext.gettext("The selected template's method (%s) is not implemented. Options are: after, before, append, prepend, wrap"),response.method));}
$(response.htmlNode)[response.method](newElement);response.element=newElement;return response;},replace:function(response){var
context=applyContextProcessors(response),renderedTemplate=renderToString(response.template,context),newElement=$(renderedTemplate);$(response.htmlNode).replaceWith(newElement);response.element=newElement;return response;},update:function(response){var
acceptedAttributes=['class','rel'],searchFor;response=broke.extend({attribute:'rel',childrenOnly:true},response);searchFor=response.childrenOnly?'> *':'*';if(!builtins.has(acceptedAttributes,response.attribute)){throw broke.exceptions.NotImplementedError(builtins.interpolate(gettext.gettext("You can not use %s's attribute. Options are: class, rel"),response.attribute));}
$(response.htmlNode).find(searchFor).each(function(){var
_this=$(this),key;for(key in response.object.fields){if(response.object.fields.hasOwnProperty(key)&&_this.attr(response.attribute)!==undefined){if(_this.attr(response.attribute).contains(key)){_this.html(response.object.fields[key]);}}}});response.element=response.htmlNode;return true;}}});})();(function(){broke.extend(broke,{middleware:{}});});(function(){broke.extend(broke.middleware,{common:{CommonMiddleware:{processResponse:function(response){if(response.event!==undefined){if(broke.conf.settings.HIDE_HASH||broke.conf.settings.PREVENT_DEFAULT){response.event.preventDefault();}
if(broke.conf.settings.STOP_PROPAGATION){response.event.stopPropagation();}
if(response.preventDefault===false&&response.event.isDefaultPrevented()){location.hash=response.url;}}
return this;}}}});})();(function(){broke.extend({views:{defaults:{setLanguage:function(request){var next=request.REQUEST['next']||null,response={},settings=broke.conf.settings,langCode,checkForLanguage;if(!next){next=request.META['HTTP_REFERER'];}
if(!next){next='';}
langCode=request.REQUEST['language']||null;if(true){if('session'in request){request.session.brokeLanguage=langCode;}else if('cookie'in request){}else{window.location.href=window.location.href.split('#')[0].split('?')[0]+'?language='+langCode;}}
return{};},pageNotFound:function(request){broke.log(gettext.gettext("No matching url found, fail silently..."));}}}});})();(function(){var
Model=broke.db.models.Model,Manager=broke.db.models.Manager,ContentType,ContentTypeManager;broke.contrib.contenttypes={models:{}};ContentType=Model.create({__name__:"broke.contrib.contenttypes.models.ContentType",fields:{app_label:null,model:null}});})();(function(){var
GenericForeignKey,contenttypes=broke.contrib.contenttypes,ContentType=contenttypes.models.ContentType,Field=broke.db.fields.Field,getModel=broke.db.models.getModel;GenericForeignKey=Field.create({__name__:"broke.contrib.contenttypes.generic.GenericForeignKey",__init__:function(kwargs){kwargs=kwargs||{};this.ct_field=kwargs.ct_field||'content_type';this.fk_field=kwargs.fk_field||'object_id';},__call__:function(instance,callableObject,callback){var
genericFkField=this;ContentType.objects.get({pk:instance.fields[genericFkField.ct_field]},function(contentType){var
model=getModel(contentType.fields.app_label,contentType.fields.model);model.objects.filter({pk:instance.fields[genericFkField.fk_field]}).all(function(object){if(callback){object=object[0];callback(object);}});});}});})();
